!function(t){"use strict";"object"==typeof module&&"object"==typeof module.exports?t(require("jquery"),window,document):t(jQuery,window,document)}(function($,t,e,n){"use strict";if(!t.history.pushState)return $.fn.smoothState=function(){return this},void($.fn.smoothState.options={});if(!$.fn.smoothState){var o=$("html, body"),r=t.console,a={debug:!1,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:!1,repeatDelay:500,blacklist:".no-smoothState",prefetch:!1,prefetchOn:"mouseover touchstart",prefetchBlacklist:".no-prefetch",cacheLength:0,loadingClass:"is-loading",scroll:!0,alterRequest:function(t){return t},alterChangeState:function(t,e,n){return t},onBefore:function(t,e){},onStart:{duration:0,render:function(t){}},onProgress:{duration:0,render:function(t){}},onReady:{duration:0,render:function(t,e){t.html(e)}},onAfter:function(t,e){}},i={isExternal:function(e){var n=e.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof n[1]&&n[1].length>0&&n[1].toLowerCase()!==t.location.protocol?!0:"string"==typeof n[2]&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host},stripHash:function(t){return t.replace(/#.*/,"")},isHash:function(e,n){n=n||t.location.href;var o=e.indexOf("#")>-1,r=i.stripHash(e)===i.stripHash(n);return o&&r},translate:function(t){var e={dataType:"html",type:"GET"};return t="string"==typeof t?$.extend({},e,{url:t}):$.extend({},e,t)},shouldLoadAnchor:function(t,e,o){var r=t.prop("href");return!(i.isExternal(r)||i.isHash(r)||t.is(e)||t.prop("target")||typeof o!==n&&""!==o&&-1===t.prop("href").search(o))},clearIfOverCapacity:function(t,e){return Object.keys||(Object.keys=function(t){var e=[],n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}),Object.keys(t).length>e&&(t={}),t},storePageIn:function(t,e,n,o,r){var a=$("<html></html>").append($(n));return t[e]={status:"loaded",title:a.find("title").first().text(),html:a.find("#"+o),doc:n,state:r},t},triggerAllAnimationEndEvent:function(t,e){e=" "+e||"";var n=0,o="animationstart webkitAnimationStart oanimationstart MSAnimationStart",r="animationend webkitAnimationEnd oanimationend MSAnimationEnd",a="allanimationend",s=function(e){$(e.delegateTarget).is(t)&&(e.stopPropagation(),n++)},l=function(e){$(e.delegateTarget).is(t)&&(e.stopPropagation(),n--,0===n&&t.trigger(a))};t.on(o,s),t.on(r,l),t.on("allanimationend"+e,function(){n=0,i.redraw(t)})},redraw:function(t){t.height()}},s=function(e){if(null!==e.state){var n=t.location.href,o=$("#"+e.state.id),r=o.data("smoothState"),a=r.href!==n&&!i.isHash(n,r.href),s=event.state!==r.cache[r.href].state;(a||s)&&(s&&r.clear(r.href),r.load(n,!1))}},l=function(a,s){var l=$(a),u=l.prop("id"),c=null,f=!1,h={},d={},p=t.location.href,g=function(t){t=t||!1,t&&h.hasOwnProperty(t)?delete h[t]:h={},l.data("smoothState").cache=h},m=function(t,e){e=e||$.noop;var n=i.translate(t);if(h=i.clearIfOverCapacity(h,s.cacheLength),!h.hasOwnProperty(n.url)||"undefined"!=typeof n.data){h[n.url]={status:"fetching"};var o=$.ajax(n);o.done(function(t){i.storePageIn(h,n.url,t,u),l.data("smoothState").cache=h}),o.fail(function(){h[n.url].status="error"}),e&&o.always(e)}},y=function(){if(c){var t=$(c,l);if(t.length){var e=t.offset().top;o.scrollTop(e)}c=null}},v=function(n){var a="#"+u,i=h[n]?$(h[n].html.html()):null;i.length?(e.title=h[n].title,l.data("smoothState").href=n,s.loadingClass&&o.removeClass(s.loadingClass),s.onReady.render(l,i),l.one("ss.onReadyEnd",function(){f=!1,s.onAfter(l,i),s.scroll&&y()}),t.setTimeout(function(){l.trigger("ss.onReadyEnd")},s.onReady.duration)):!i&&s.debug&&r?r.warn("No element with an id of "+a+" in response from "+n+" in "+h):t.location=n},S=function(e,n,a){var c=i.translate(e);"undefined"==typeof n&&(n=!0),"undefined"==typeof a&&(a=!0);var f=!1,p=!1,y={loaded:function(){var e=f?"ss.onProgressEnd":"ss.onStartEnd";p&&f?p&&v(c.url):l.one(e,function(){v(c.url),a||g(c.url)}),n&&(d=s.alterChangeState({id:u},h[c.url].title,c.url),h[c.url].state=d,t.history.pushState(d,h[c.url].title,c.url)),p&&!a&&g(c.url)},fetching:function(){f||(f=!0,l.one("ss.onStartEnd",function(){s.loadingClass&&o.addClass(s.loadingClass),s.onProgress.render(l),t.setTimeout(function(){l.trigger("ss.onProgressEnd"),p=!0},s.onProgress.duration)})),t.setTimeout(function(){h.hasOwnProperty(c.url)&&y[h[c.url].status]()},10)},error:function(){s.debug&&r?r.log("There was an error loading: "+c.url):t.location=c.url}};h.hasOwnProperty(c.url)||m(c),s.onStart.render(l),t.setTimeout(function(){s.scroll&&o.scrollTop(0),l.trigger("ss.onStartEnd")},s.onStart.duration),y[h[c.url].status]()},w=function(t){var e,n=$(t.currentTarget);i.shouldLoadAnchor(n,s.blacklist,s.hrefRegex)&&!f&&(t.stopPropagation(),e=i.translate(n.prop("href")),e=s.alterRequest(e),m(e))},E=function(t){var e=$(t.currentTarget);if(!t.metaKey&&!t.ctrlKey&&i.shouldLoadAnchor(e,s.blacklist,s.hrefRegex)&&(t.stopPropagation(),t.preventDefault(),!P())){T();var n=i.translate(e.prop("href"));f=!0,c=e.prop("hash"),n=s.alterRequest(n),s.onBefore(e,l),S(n)}},b=function(t){var e=$(t.currentTarget);if(!e.is(s.blacklist)&&(t.preventDefault(),t.stopPropagation(),!P())){T();var o={url:e.prop("action"),data:e.serialize(),type:e.prop("method")};f=!0,o=s.alterRequest(o),"get"===o.type.toLowerCase()&&(o.url=o.url+"?"+o.data),s.onBefore(e,l),S(o,n,s.allowFormCaching)}},C=0,P=function(){var t=null===s.repeatDelay,e=parseInt(Date.now())>C;return!(t||e)},T=function(){C=parseInt(Date.now())+parseInt(s.repeatDelay)},A=function(t){s.anchors&&(t.on("click",s.anchors,E),s.prefetch&&t.find(s.anchors).not(s.prefetchBlacklist).on(s.prefetchOn,null,w)),s.forms&&t.on("submit",s.forms,b)},O=function(){var t=l.prop("class");l.removeClass(t),i.redraw(l),l.addClass(t)};return s=$.extend({},$.fn.smoothState.options,s),null===t.history.state?(d=s.alterChangeState({id:u},e.title,p),t.history.replaceState(d,e.title,p)):d={},i.storePageIn(h,p,e.documentElement.outerHTML,u,d),i.triggerAllAnimationEndEvent(l,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),A(l),{href:p,cache:h,clear:g,load:S,fetch:m,restartCSSAnimations:O}},u=function(t){return this.each(function(){var e=this.tagName.toLowerCase();this.id&&"body"!==e&&"html"!==e&&!$.data(this,"smoothState")?$.data(this,"smoothState",new l(this,t)):!this.id&&r?r.warn("Every smoothState container needs an id but the following one does not have one:",this):"body"!==e&&"html"!==e||!r||r.warn("The smoothstate container cannot be the "+this.tagName+" tag")})};t.onpopstate=s,$.smoothStateUtility=i,$.fn.smoothState=u,$.fn.smoothState.options=a}});